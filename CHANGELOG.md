# 更新日志

本项目遵循语义化版本号（SemVer）格式记录变更。

## v1.2.1（2026-01-04）

### 新增

- 结算中心：选择「支付宝」缴费方式时，自动展示已配置的收款二维码（位于缴费方式下方）。

### 修复

- 推广关系管理：修复关系列表中用户信息/+1/+2 展示为空的问题（加载顺序与查找方式优化）。
- 侧边栏：修复页面跳转后菜单滚动位置丢失的问题（自动记住并恢复滚动位置）。

### 变更

- 导航菜单：暂时隐藏「充值中心」与「充值管理」入口（功能保留，仅下掉前端入口）。
- 文档：README 中「进群二维码」图片展示尺寸调整，避免占用过大版面。

## v1.2.0（2026-01-03）

### 新增

- 结算中心（阶段1）：结算期、关系快照、收益汇总、应缴、缴费记录与管理员审核（`/settlement-center`、`/admin/settlement-payments`）。
- 分成钱包（阶段2）：分成明细、下级缴清后资金化入账（locked）、钱包账本流水与汇总（`/wallet`）。
- 解锁/提现（阶段3）：分成解锁（locked -> available）、用户提现申请/取消、管理员提现审核/打款/驳回（`/admin/withdraw-requests`）。
- 仪表板新手引导：下载 APK、查看说明文档、进群二维码三栏并排展示。

### 变更

- 钱包统一使用 coins 口径记账与对账，展示金额按 `coin_rate` 换算。
- 管理端确认缴费：首次缴清触发分成资金化入账，并在满足条件时即时解锁。

### 安全

- 提现相关页面对用户可控字段做基础 HTML 转义，避免 XSS。

## v1.1.1

### 修复

- 修复同步青龙环境变量时，本地 `ql_env_id` 失效导致更新失败的问题：当青龙侧环境变量已被删除/重置时，原逻辑对 `PUT /open/envs` 直接更新会返回 `Env {"id":xx} not found`；现改为按 `env_name` 进行 upsert（存在则更新，不存在则创建），并回写最新 `ql_env_id`。

### 新增

- 增加日志文件持久化存储：Docker 部署默认将容器内日志目录 `/app/logs` 挂载到宿主机 `./logs`（见 `docker-compose.yml` 的 `volumes`）。
- 增加日志轮转配置：支持通过环境变量控制日志输出与按大小滚动（如 `LOG_MAX_BYTES=10485760` 表示单文件 10MB，`LOG_BACKUP_COUNT=5` 表示保留 5 份滚动文件）。
